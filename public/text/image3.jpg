<?php

if (file_exists('imagettftextblur.php'))
	require_once('imagettftextblur.php');
else
	die('imagettftextblur.php not found');


//default values
$uri = 'http://maps.googleapis.com/maps/api/staticmap?';
$AND = '&';
$zoom = $_GET["zoom"];
$scale = '2';
$size = '640x360';
$maptype = 'roadmap';
$format = 'png';
$visual_refresh = 'false';
$micon = 'http://dl.dropboxusercontent.com/u/691052/icon/marker_googlemaps_75.png';
$shadow = 'true';
$address = $_GET["address"];
$address_url = str_replace(' ', '+', $address);



  // Set Text to Be Printed On Image
  list($text)=explode(',', $address);
  $text = ucwords($text);

// Create URL

$imageurl = $uri .
          'zoom=' . $zoom .
          '&center=' . $address_url .
          '&scale=' . $scale .
          '&size=' . $size .
          '&maptype=' . $maptype .
          '&format=' . $format .
          '&visual_refresh=' . $visual_refresh .
          '&markers=scale:2|icon:' . $micon .
          '%7Cshadow:' . $shadow .
          '%7C' . $address_url;


  

  
  $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $imageurl); 
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); // good edit, thanks!
    curl_setopt($ch, CURLOPT_BINARYTRANSFER, 1); // also, this seems wise considering output is image.
    $data = curl_exec($ch);
    curl_close($ch);

    $source_image = imagecreatefromstring($data);

	$width  = imagesx($source_image);                             //get width of source image
	$height = imagesy($source_image);                             //get height of source image
	$image = imagecreatetruecolor($width,$height);        //create new image of true colors with given width and height
	imagecopy($image,$source_image,0,0,0,0,$width,$height);      //copy source image to new one


  // Create Image From Existing File
  //  $jpg_image = imagecreatefromjpeg('sunset.jpg');


  // Allocate A Color For The Text
  $blur_color = imagecolorallocate($image, 255, 255, 255);
  $font_color = imagecolorallocate($image, 107, 33, 42);


  // Set Path to Font File
  $font_path = 'Roboto-Medium.ttf';

  // Print Text On Image
  imagettftextblur($image, 20, 0, 663, 363, $blur_color, $font_path, $text,5);
  imagettftextblur($image, 20, 0, 663, 363, $font_color, $font_path, $text);

  //Set the Content Type
if ($_GET['dl']==1) {
	  header('Content-type: application/octet-stream');
  } else {
	  header('Content-type: image/jpeg');
  }

  // Send Image to Browser
  imagejpeg($image,NULL,100);

  // Clear Memory
  imagedestroy($image);
  
  
  
  
?>